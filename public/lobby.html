<html>
<p>&nbsp;</p>
<table style="height: 87px; background-color: #666666; border-color: #000000; margin-left: auto; margin-right: auto;" border="7" width="500">
<tbody>
<tr>
<td style="width: 636px; border-color: #000000;">
<h1 style="text-align: center;"><strong><span style="color: #ff9900;">ooof</span></strong></h1>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<table style="height: 486px; background-color: #666666; border-color: #222222; margin-left: auto; margin-right: auto; width: 500px;" border="5"><caption>
<h2
	<span id="game_name_display"></span>
</h2>
</caption>
<tbody>
<tr>
<td style="width: 250px; text-align: center;">
<table style="height: 50px; margin-left: auto; margin-right: auto;" width="450">
<tbody>
<tr>
<td style="width: 426.016px;">
<h2 style="text-align: center;"><span style="color: #00ff00;">Users:</span></h2>
<hr style="border-width:3px;"></td>
</tr>
</tbody>
</table>
<table style="height: 340px; margin-left: auto; margin-right: auto;" width="450">
<tbody>
<tr>
<td style="width: 318.516px; text-align: center;"><strong><span style="color: #00ccff;">
	<div id="users_txt"></div>
</span>
</strong></td>
</tr>
</tbody>
</table>
<table style="height: 40px; margin-left: auto; margin-right: auto;" width="450">
<tbody>
<tr>
<td style="width: 41.0156px; text-align: center;">
	<span id="start_game"></span>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>

<script src="connectSocket.js"></script>

<script>
	(function(){
	
		// var socket_server_ip = ['http://192.168.1.88:4000', 'https://cb99026a.ngrok.io']
	
		// show start game button if owner
		if(localStorage.is_owner == 'true'){
			start_game.innerHTML = "<button id='start_game_btn'>Start Game!, Mr. Owner</button>"
		}
	
		var element = function(id){
			return document.getElementById(id);
		}
		
		var game_name_display = element('game_name_display');
		var users_txt = element('users_txt')
		var start_game_btn = element('start_game_btn')

	
		game_name_display.innerHTML = "Room: " + localStorage.game_name
		
		// Connect to socket.io
		var socket = returnSocket(0)
		
		// Check for connection
		if(socket !== undefined){
		
			console.log('Connected to socket...');
			
			// Connect to room
			socket.on('connect', () => {
				console.log('connect')
				socket.emit('join_room', {
					room_name: localStorage.game_name
				})
			})
			
			// function that emits socket to update player list
			var updatePlayers = function(){
				console.log("reload!")
				socket.emit('reload_lobby', {
					game_name: localStorage.game_name
				})
			}
			
			// Update player list when page is loaded
			updatePlayers()
			
			// Handle array of players in game
			socket.on('reload_lobby', (data) => {
				var users = data.users_array
				var users_list = ""
				for(var x=0; x<users.length; x++){
					users_list += users[x].name
					if(users[x].is_owner == 1){
						console.log("hi")
						users_list += "👍🏾"
					}
					users_list += "<br>"
				}
				console.log(users_list)
				users_txt.innerHTML = users_list
			})
			
			// Handle new player
			socket.on('new_player', () => {
				console.log('newplayers')
				updatePlayers()
			})
			
			// Handle start game button
			if(localStorage.is_owner == 'true'){
				start_game_btn.addEventListener('click', () => {
					socket.emit('start_game', {
						starting_game_name: localStorage.game_name,
						room_name: localStorage.game_name
					})
				})
			}
			
			// Handle start of game
			socket.on('game_has_started', () => {
				window.location.replace('game.html')
			})
			
		}
		
	})();
</script>