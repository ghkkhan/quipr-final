<div>
<table style="height: 87px; background-color: #666666; border-color: #000000; margin-left: auto; margin-right: auto;" border="7" width="500">
<tbody>
<tr>
<td style="width: 636px; border-color: #000000;">
<h1 style="text-align: center;"><span style="color: #800080;"><strong>ooof</strong></span></h1>
</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>&nbsp;</p>
</div>
<div>
<table style="height: 486px; background-color: #666666; border-color: #222222; margin-left: auto; margin-right: auto; width: 500px;" border="5"><caption>
<h2><span style="color: #ff9900;">
	<span id="game_name_display"></span>
	<span id="timer_display">timer:</span>
</h2>
</caption>
<tbody>
<tr>
<td style="width: 250px; text-align: center;">
<table style="height: 500px; width: 511px;" border="1">
<tbody>
<tr>
<td style="width: 257.5px;">
<p style="text-align: center;"><span style="color: #00ccff;"><strong id="questionNumber"></strong></span></p>
<p style="text-align: center;"><span id="prompt" style="color: #ffffff;"></span></p>
<p style="text-align: center;">&nbsp;</p>
	<span id="prompt_display"></span>
	<span id="response_area">

<p id="text" style="text-align: center;">
	
	<input id="response_txt" type="text" placeholder="Reponse">

</p>
<p id="submit" style="text-align: center;">

	<button id="submit_btn">OOF!</button>
	</span>
	
</p>
</td>
<td id="users" style="width: 239.5px; text-align: center;">

	<span id="names>
	</span>
	
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<div id="php">
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>

<script src="../connectSocket.js"></script>

<script src="loadPrompts.js"></script>

<script>
	(function(){
	
		var element = function(id){
			return document.getElementById(id);
		}
		
		var game_name_display = element('game_name_display');
		var timer_display = element('timer_display')
		var prompt_display = element('prompt_display')
		var response_area = element('response_area')
		var response_txt = element('response_txt')
		var submit_btn = element('submit_btn')

	
		game_name_display.innerHTML = "Room: " + localStorage.game_name
		
		// Connect to socket.io
		var socket = returnSocket()
		
		// Check for connection
		if(socket !== undefined){
		
			console.log('Connected to socket...');
			
			// Connect to room
			socket.on('connect', () => {
				socket.emit('join_room', {
					room_name: localStorage.game_name
				})
			})
			
			//get timer initial count
			socket.emit('get_timer', {
				game_name: localStorage.game_name
			})
			
			// set timer to initial count
			var timer = { time: 0 }
			socket.on('update_timer_display', (data) => {
				timer.time = data.time
				timer_display.innerHTML = timer.time
			})
			
			function decTimeAndDisplay(obj, element){
				obj.time = obj.time - 1
				element.innerHTML = obj.time
			}
			
			setInterval(() => {decTimeAndDisplay(timer, timer_display)}, 1000)
			
			/* If serverside timer update is wanted: delete sockets from above and uncomment
			socket.on('update_timer', () => {
				socket.emit('get_timer', {
					game_name: localStorage.game_name
				})
			})
			
			socket.on('update_timer_display', (data) => {
				console.log(data)
				timer_display.innerHTML = data.time
			})*/
			
			// when timer runs down to 0 on server side
			socket.on('move_to_voting', () => {
				window.location.replace('voting.html')
			})
			
			function sendPromptRequest(prompt_num){
				socket.emit('get_prompt', {
					prompt_num: prompt_num,
					user_name: localStorage.user_name,
					game_name: localStorage.game_name
				})
			}
			
			// Handle submit response button
			submit_btn.addEventListener('click', () => {
				sendPromptRequest(2)
				socket.emit('response_submited', {
					response: response_txt.value,
					user_name: localStorage.user_name,
					game_name: localStorage.game_name,
					room_name: localStorage.game_name
				})
			})
			
			// Handle when two answers are submitted
			socket.on('both_responses_done', () => {
				response_area.innerHTML = ''
			})
			
			// Get prompt on load
			socket.on('connect', () => {
				sendPromptRequest(1)
			})
			
			// Handle getting prompt id number
			socket.on('display_prompt', (data) => {
				getPromptFromIdAndDisplay(data.prompt_id, prompt_display)
			
				// prompt_display.innerHTML = data.prompt_id
			})
			
		}
		
	})();
</script>


